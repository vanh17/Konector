<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <!-- Bootstrap CSS -->
    <link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

  </head>
  <body>
      
      <nav class="navbar navbar-light bg-faded">
  <a class="navbar-brand" href="/">Konector</a>
  <ul class="nav navbar-nav">
    <!-- <li class="nav-item">
      <a class="nav-link" href="?page=timeline">Your timeline</a>
    </li> -->
    <li class="nav-item">
      <a class="nav-link" href="/users/skiadas/messages">Your Konects</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="/users/skiadas">Public Profiles</a>
    </li>
  </ul>
  <div class="form-inline pull-xs-right">
      
      <!-- <?php if ($_SESSION['id']) { ?> -->
      {% if session.logged_in %}
      
        <a class="btn btn-success-outline" href="?function=logout">Logout</a>
      
      {% else %}
      
		<button class="btn btn-success-outline" data-toggle="modal" data-target="#myModal">Login/Signup</button>
      
      {% endif %}
  </div>
</nav>
{% if has_result %}
<!-- Public profiles -->
{% if result['route'] == 'user_page' %}
{% if result['check'] %}
<div class="container mainContainer">

    <div class="row">
  		<div class="col-md-8">
      
        	<!-- <?php if ($_GET['id']) { ?>
      
      		<?php displayTweets($_GET['id']); ?>
      
      		<?php } else { ?>  -->
        
        	<!-- <h2>Active Users</h2>
        
        	<?php displayUsers(); ?>
      
      		<?php } ?> -->
      		<h2> {{ result['user'] }} </h2>
      		<li><a href="{{ result['create']['url'] }}">Creat Konect</a></li>
      		<li><a href="{{ result['tweet'] }}">Your Konects</a></li>
        </div>
        {% else %}
  		<div>
			<h2>Invalid username:</h2>

			<li> {{ result['user'] }}</li>

			<hr>
			
		</div>
        
        	<!-- <?php displaySearch(); ?>
      
      		<hr>
      
      		<?php displayTweetBox(); ?> -->
	</div>
</div>
{% endif %}
<!-- Public profiles end -->
{% elif result['route'] == 'messages_search' %}
<!-- Search -->
<div class="container mainContainer">

    <div class="row">
  <div class="col-md-8">
        
        <h2>Search Results</h2>
        
        <?php displayTweets('search'); ?>
      
        </div>
  <div class="col-md-4">
        
        <?php displaySearch(); ?>
      
      <hr>
      
      <?php displayTweetBox(); ?>
        
        </div>
</div>
    
</div>
<!-- Search ends -->
<!-- Timeline -->
<!-- <div class="container mainContainer">

    <div class="row">
  <div class="col-md-8">
        
        <h2>Tweets For You</h2>
        
        <!-- <?php displayTweets('isFollowing'); ?> -->
      
        </div>
  <div class="col-md-4">
        
        <!-- <?php displaySearch(); ?> -->
      
      <hr>
      
      <!-- <?php displayTweetBox(); ?> -->
        
        </div>
</div>
    
</div> -->
<!-- Timeline end -->
<!--your tweets -->
{% elif result['route'] == 'user_messages' %}
<div class="container mainContainer">

    <div class="row">
  		<div class="col-md-8">
        
        	<h1><b>Your tweets</b></h1>
        	<hr>
        	<br>
				<!-- <ul class="tab" id="tabs">
  					<li><a href data-target="#received" class="tablinks">Inbox</a></li>
  					<li><a href data-target="#sent"  class="tablinks">Sent</a></li>
  					<li><a href data-target="#unread"  class="tablinks">Unread</a></li>
				</ul> -->
				<div id="received">
				    <h2>Received Messages</h2>
  					{% if result['received']|length > 0 %}
        			{% for message in result['received'] %}
        		    	<a class="message" href={{ message['url'] }}>
        		    	<div class = "container">
        		    		<p class='from'>From: {{ message['from'] }}</p>  	
        			    	<p class='subject'>Subject: {{ message['subject'] }} &nbsp;&nbsp; {{ message['created'] }}</p>
        					<p class='body'>{{ message['body'] }}</p>
        				</div>
        				</a>
        				<br>
        			{% endfor %}
        			{% else %}
        			<p>You have no message(s)</p>
        			{% endif %}
				</div>

				<div id="sent">
					<h2>Sent Messages</h2>
	  				{% if result['sent']|length > 0 %}
	        		{% for message in result['sent'] %}
	        		    <a class="message" href={{ message['url'] }}>
	        		    <div class = "container">
	        		    	<p class='from'>From: {{ message['from'] }}</p>  	
	        			    <p class='subject'>Subject: {{ message['subject'] }} &nbsp;&nbsp; {{ message['created'] }}</p>
	        				<p class='body'>{{ message['body'] }}</p>
	        			</div>
	        			</a>
	        			<br>
	        		{% endfor %}
	        		{% else %}
	        		<p>You have no message(s)</p>
	        		{% endif %}
				</div>

				<div id="unread">
					<h2>Unread Messages</h2>
		  			{% if result['unread']|length > 0 %}
	        		{% for message in result['sent'] %}
	        		    <a class="message" href={{ message['url'] }}>
	        		    <div class = "container">
	        		    	<p class='from'>From: {{ message['from'] }}</p>  	
	        			    <p class='subject'>Subject: {{ message['subject'] }} &nbsp;&nbsp; {{ message['created'] }}</p>
	        				<p class='body'>{{ message['body'] }}</p>
	        			</div>
	        			</a>
	        			<br>
	        		{% endfor %}
	        		{% else %}
	        		<p>You have no message(s)</p>
	        		{% endif %}
				</div>
			</div>
		</div>
</div>
{% endif %}
{% endif %}
<!-- End your tweets -->
<!-- Footer -->
<footer class="footer">

    <div class="container">
        
        <p>&copy; <a href="https://github.com/vanh17/konector/">Konector 2016</a></p>
    
    </div>

</footer>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/js/bootstrap.min.js" integrity="sha384-vZ2WRJMwsjRMW/8U7i6PWi6AlO1L79snBrmgiDpgIWJ82z8eA5lenwvxbMV1PAh7" crossorigin="anonymous"></script>

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title" id="loginModalTitle">Login</h4>
      </div>
      <div class="modal-body">
        <div id="loginAlert" class="alert alert-danger"></div>
        <form action="" method="post">
            <input type="hidden" id="loginActive" name="loginActive" value="1">
            <div id="divSignup" style="display: none;">
            <fieldset class="form-group">
    			<label for="name">Full Name</label>
    			<input type="text" class="form-control" id="name" placeholder="Full Name">
  			</fieldset>
  			</div>
  			<fieldset class="form-group">
    			<label for="email">Username</label>
    			<input type="text" class="form-control" id="username" placeholder="Username">
  			</fieldset>
  			<fieldset class="form-group">
    			<label for="password">Password</label>
    			<input type="password" class="form-control" id="password" placeholder="Password">
  			</fieldset>
		</form>
      </div>
      <div class="modal-footer">
          <a id="toggleLogin">Sign up</a>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" id="loginSignupButton" class="btn btn-primary">Login</button>
      </div>
    </div>
  </div>
</div>

<script>
    $("#toggleLogin").click(function() {
        
        if ($("#loginActive").val() == "1") {
            
            $("#loginActive").val("0");
            $("#loginModalTitle").html("Sign Up");
            $("#loginSignupButton").html("Sign Up");
            $("#divSignup").show();
            $("#toggleLogin").html("Login");
            
            
        } else {
            
            $("#loginActive").val("1");
            $("#loginModalTitle").html("Login");
            $("#loginSignupButton").html("Login");
            $("#divSignup").hide()
            $("#toggleLogin").html("Sign up");
            
        }
        
        
    })

    $(function() {
    	$('#tabs').tabs();
    })
    
    
    $("#loginSignupButton").click(function() {

        if ($("#loginActive").val() == "1") {
        	$.ajax({
            type: "POST",
            url: "/login",
            data: "username=" + $("#username").val() + "&password=" + $("#password").val() + "&loginActive=" + $("#loginActive").val(),
            success: function(result) {
               baseUrl = '127.0.0.1:5000/'
               // if (result == '') {
               // 		location.href = baseUrl + 'users'
               // }
               window.location.href="/users/" + $("#username").val();
            },
            error: function(result) {
              $('#loginAlert').html(result['responseJSON']['error']);
              $('#loginAlert').show();
            }    
        	})
        } else {
        	$.ajax({
            type: "POST",
            url: "/signup",
            data: "username=" + $("#username").val() + "&name=" + $("#name").val() + "&password=" + $("#password").val() + "&loginActive=" + $("#loginActive").val(),
            success: function(result) {
               // baseUrl = '127.0.0.1:5000/'
               // if (result == '') {
               // 		location.href = baseUrl + 'users'
               // }
               // console.log(result)
               window.location.href="/users/" + $("#username")
            },
            error: function(result) {
              $('#loginAlert').html(result['responseJSON']['error']);
              $('#loginAlert').show();
            }    
        	})
        }
        
        
    })
    $(".toggleFollow").click(function() {
        
        var id = $(this).attr("data-userId");
        
        $.ajax({
            type: "POST",
            url: "actions.php?action=toggleFollow",
            data: "userId=" + id,
            success: function(result) {
                
                if (result == "1") {
                    
                    $("a[data-userId='" + id + "']").html("Follow");
                    
                } else if (result == "2") {
                    
                    $("a[data-userId='" + id + "']").html("Unfollow");
                    
                }
            }
            
        })
        
    })
    
    $("#postTweetButton").click(function() {
        
        $.ajax({
            type: "POST",
            url: "actions.php?action=postTweet",
            data: "tweetContent=" + $("#tweetContent").val(),
            success: function(result) {
                
                if (result == "1") {
                    
                    $("#tweetSuccess").show();
                    $("#tweetFail").hide();
                    
                } else if (result != "") {
                    
                    $("#tweetFail").html(result).show();
                    $("#tweetSuccess").hide();
                    
                }
            }
            
        })
        
    })
    
</script>
<!-- End footer -->
</body>	
</html>